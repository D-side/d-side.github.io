---
layout: post
title: Кэшируем диск диском
---

Около года назад я занимался настройкой на настольном компьютере кэша для <abbr title="Hard Disk Drive, жёсткий магнитный диск">HDD</abbr> с помощью <abbr title="Solid State Drive, твердотельный диск">SSD</abbr> посредством <abbr title="Intel Smart Response Technology">Intel SRT</abbr>. Берём медленный HDD, отделяем от SSD кусок для кэширования часто используемых частей HDD. Удобно, скажем, чтобы не заниматься жонглированием игр между библиотеками Steam на разных дисках, но при этом обеспечить быструю загрузку последних запущенных.

Итак, у меня в системе есть SSD и HDD, ничего что не жалко потерять, флэшка-установщик Windows 10. На SSD старая ОС и кусок неразмеченного места (не занятого разделами) в конце диска, который я намеревался отдать под кэш.

У меня был план следующего характера: на SSD разместить ОС и кэш для HDD, а на HDD разместить всё сколько-нибудь тяжёлое. **Скопировав всё ценное**, я взялся за дело.

Пошло... не вполне гладко.

### "Подождите, а как включить-то?"

В утилите Intel Rapid Storage Technology просто не было вкладки "Производительность", на которой эта функция по всем признакам должна бы скрываться. Не было ни вкладки, ни Intel SRT. Я уточнил, что моя материнская плата это поддерживает (что, кроме очевидных дисков, является единственным аппаратным требованием), попробовал разные версии ПО от Intel, но нет. Ничего.

Оказалось, что вкладка отсутствовала из-за того, что с единственного SSD в системе *я был на тот момент загружен*. То есть, чтобы отделить кусок диска под Intel SRT, мне нужно было загрузить ОС с другого диска, не с того, на котором будет находиться кэш. Пожав плечами, я водрузил ОС на HDD (включая загрузочный раздел) и загрузился оттуда. Установив необходимый минимум и ПО от Intel **да**, я увидел эту вкладку!

### "Э-эй, куда делась старая ОС?"

Создав кэш на SSD, я обнаружил, что раздел, на котором была установлена моя старая ОС, испарился. При этом загрузочный EFI-раздел с загрузчиком Windows уцелел и Windows пытался загрузиться, но падал с кодом "inaccessible boot device" (устройство для загрузки недоступно). Но почему?

"Ну и шут с вами, я переустанавливаю шиндошс по три раза в день!" &mdash; подумал я и запустил установщик Windows 10. И отметил интересную деталь: у SSD изменилось название! Вместо фирмы-производителя и модели название стало "Volume Много-Цифр".

Хм. Видимо, так эта технология и работает: скрывает физический диск, а вместо него показывает на аппаратном уровне диск меньшего размера (общая ёмкость минус размер кэша). И поскольку изменился идентификатор диска, загрузчик Windows не мог найти *не только раздел со старой ОС, но и устройство, на котором он был!*

На этом этапе, возможно, был способ сэкономить время и просто переустановить загрузчик, но я по одному себе ведомым причинам решил зачистить весь диск. Предсказуемо, помогло. И загрузившись в новую ОС на SSD с уже включенным кэшем, я всё же обнаружил в ПО Intel вкладку "Производительность". Интересные, однако, дела. То есть, эта вкладка скрывается, если (а) нет дисков с кэшем и (б) нет дисков, на которых кэш можно создать. Ладно. Теперь хотя бы понятно, с чем это связано.

---

На этом история заканчивается. Я поудалял разделы временного Windows с HDD и сделал там новый здоровенный раздел для библиотеки Steam и прочих "крупных грузов", после чего подключил созданный на SSD кэш к этому здоровенному разделу, и всё заработало именно так, как я хотел. Победа!

Изначально этот рассказ должен был стать лишь разделом более крупного поста о том, как я заводил себе личное домашнее облако. Но рассказ приобрёл существенный объём, да и с остальным содержимым поста был связан очень слабо, поэтому я решил опубликовать его отдельно.